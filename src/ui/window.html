<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.2">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="full-page-wrapper">
        <svg id="main" viewBox="0 0 2000 2000">
            <g id="graph">
                <g id="thin-layer" transform="translate(0.5,0.5)">
                    <circle
                        id="bullet"
                        cx="1000"
                        cy="1000"
                        r="0"
                        stroke="#1e2828"
                        stroke-width="0"
                        fill="#66ffff" />
                </g>

                <g id="thick-layer">
                </g>
            </g>
        </svg>
    </div>
    <script src="logo.js"></script>
    <script src="grid.js"></script>
    <script src="menu.js"></script>
    <script src="window.js"></script>
    <script>
        const graphSvg = document.getElementById('main');
        const grid = createGrid(graphSvg);
         function createMenu() {
            // Initialize grid
            grid.setBox('inputs', { invisible: true }, 0, 0);
            grid.setBox('outputs', { invisible: true }, 0, 1);
            grid.addLine('inputs', 'outputs');
            grid.focusLine('inputs', 'outputs');
            grid.commit();

            // Test menu
            let menu = null;
            window.addEventListener('keydown', (e) => {
                if (e.key === 'ArrowUp') {
                    if(menu) {
                        menu.moveUp();
                    }
                } else if (e.key === 'ArrowDown') {
                    if(menu) {
                        menu.moveDown();
                    }
                } else if (e.key === 'Enter') {
                    if(!menu) {
                        menu = showMenu([
                            { id: "add_input", label: 'Add Input >' },
                            { id: "add_output", label: 'Add Output >' },
                            { id: "add_effect", label: 'Add Effect >' },
                            { id: "exit", label: 'Exit' },
                        ]);
                    } else if(menu.getSelected().id === 'add_input') {
                        showMenu([
                            { id: "audio_in", label: 'Audio' },
                            { id: "midi_in", label: 'Midi >' },
                        ]);
                    } else if(menu.getSelected().id === 'add_output') {
                        showMenu([
                            { id: "audio_out", label: 'Audio' },
                            { id: "midi_out", label: 'Midi >' },
                        ]);
                    } else if(menu.getSelected().id === 'add_effect') {
                        showMenu([
                            { id: "reverb", label: 'Reverb' },
                            { id: "delay", label: 'Delay' },
                        ]);
                    } else if(menu.getSelected().id === 'audio_in') {
                        grid.setBox('audio_input', { label: 'IN' }, 0, 0);
                        grid.removeLine('inputs', 'outputs');
                        grid.removeBox('inputs');
                        grid.addLine('audio_input', 'outputs');
                        grid.focusBox('audio_input');
                        grid.commit();
                        menu.exit();
                        menu = null;
                    } else if(menu.getSelected().id === 'audio_out') {
                        grid.setBox('audio_output', { label: 'OUT' }, 0, 1);
                        grid.removeLine('audio_input', 'outputs');
                        grid.removeBox('outputs');
                        grid.addLine('audio_input', 'audio_output');
                        grid.focusBox('audio_output');
                        grid.commit();
                        menu.exit();
                        menu = null;
                    } else if(menu.getSelected().id === 'reverb') {
                        grid.removeLine('audio_input', 'audio_output');
                        grid.setSize(1, 3);
                        grid.setBox('audio_output', {}, 0, 2);
                        grid.setBox('reverb_effect', { label: 'REV' }, 0, 1);
                        grid.focusBox('reverb_effect');
                        grid.addLine('audio_input', 'reverb_effect');
                        grid.addLine('reverb_effect', 'audio_output');
                        grid.commit();
                        menu.exit();
                        menu = null;
                    } else if(menu.getSelected().id === 'delay') {
                        grid.setSize(2, 3);
                        grid.setBox('reverb_effect', { label: 'REV' }, 0, 1);
                        grid.setBox('delay_effect', { label: 'DEL' }, 1, 1);
                        grid.setBox('audio_output', {}, 1, 2);
                        grid.focusBox('delay_effect');
                        grid.addLine('audio_input', 'delay_effect');
                        grid.addLine('delay_effect', 'audio_output');
                        grid.commit();
                        menu.exit();
                        menu = null;
                    }
                } else if (e.key === 'Backspace') {
                    if(menu && menu.close()) {
                        menu = null;
                    }
                }
            });
        };
        init(()=>{}, createMenu);
    </script>
</body>
</html>
